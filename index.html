<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Diamond Store - Free Fire</title>
    
    <!-- Script de AdSense Principal -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8397347098508270" crossorigin="anonymous"></script>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Roboto:wght@300;400;700&display=swap');

        :root {
            --ff-yellow: #ffcc00;
            --ff-blue: #00f2ff;
            --bg-dark: #0a0e17;
        }

        body {
            background-color: var(--bg-dark);
            background-image: linear-gradient(rgba(10, 14, 23, 0.95), rgba(10, 14, 23, 0.95)), url('https://images.unsplash.com/photo-1542751371-adc38448a05e?q=80&w=2070&auto=format&fit=crop');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            color: white;
            font-family: 'Roboto', sans-serif;
            min-height: 100vh;
        }

        .gaming-font { font-family: 'Orbitron', sans-serif; }

        .glass-morphism {
            background: rgba(22, 27, 34, 0.7);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .hidden-section { display: none !important; }
        
        .fade-in {
            animation: fadeIn 0.5s ease-out forwards;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        input {
            background: rgba(0, 0, 0, 0.5) !important;
            border: 1px solid rgba(0, 242, 255, 0.2) !important;
            color: white !important;
        }

        .status-pill {
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 9px;
            font-weight: bold;
            text-transform: uppercase;
        }
        .status-pendiente { background: rgba(234, 179, 8, 0.2); color: #eab308; border: 1px solid #eab308; }
        .status-completado { background: rgba(34, 197, 94, 0.2); color: #22c55e; border: 1px solid #22c55e; }

        /* Contenedor optimizado para anuncios de VIDEO */
        .ad-box {
            min-height: 350px; /* Un poco más alto para dar espacio al video */
            width: 100%;
            background: rgba(0, 0, 0, 0.4);
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            margin: 20px 0;
            border: 2px solid rgba(0, 242, 255, 0.1);
            position: relative;
        }
        
        .video-label {
            position: absolute;
            top: 10px;
            left: 10px;
            background: #ff0000;
            color: white;
            font-size: 8px;
            padding: 2px 6px;
            border-radius: 3px;
            font-weight: bold;
            z-index: 10;
        }
    </style>
</head>
<body>

    <nav id="main-nav" class="hidden-section p-4 glass-morphism sticky top-0 z-50 shadow-2xl">
        <div class="container mx-auto flex justify-between items-center">
            <div class="flex items-center gap-2 cursor-pointer" onclick="showSection('home')">
                <i class="fas fa-gem text-cyan-400 text-2xl"></i>
                <span class="gaming-font text-xl font-bold tracking-widest">FF <span class="text-cyan-400">STORE</span></span>
            </div>
            
            <div class="flex items-center gap-4">
                <button onclick="showSection('home')" class="hover:text-cyan-400 text-[10px] font-bold uppercase transition">Tienda</button>
                <button onclick="showSection('ads-rewards')" class="text-yellow-400 hover:text-white text-[10px] font-bold uppercase transition">Diamantes Gratis</button>
                <button onclick="showSection('history')" class="hover:text-cyan-400 text-[10px] font-bold uppercase transition">Mis Pedidos</button>
                <button id="admin-nav-btn" onclick="showSection('admin-panel')" class="hidden-section hover:text-red-400 text-[10px] font-bold uppercase transition">Admin</button>
                <button onclick="handleLogout()" class="text-[10px] bg-red-500/20 text-red-400 border border-red-500/30 px-3 py-1 rounded font-bold">SALIR</button>
            </div>
        </div>
    </nav>

    <main class="container mx-auto px-4 py-8">
        
        <section id="welcome-screen" class="min-h-[80vh] flex flex-col items-center justify-center fade-in">
             <i class="fas fa-gem text-cyan-400 text-7xl mb-6 animate-bounce"></i>
             <h1 class="gaming-font text-4xl mb-10 text-center text-white">DIAMOND <span class="text-cyan-400">STORE</span></h1>
             <div class="flex flex-col gap-4 w-full max-w-xs">
                <button onclick="showSection('login-form')" class="bg-cyan-500 text-black font-bold py-4 rounded-xl uppercase tracking-widest hover:bg-white transition-all">Entrar</button>
                <button onclick="showSection('register-form')" class="border border-cyan-500 text-cyan-500 font-bold py-4 rounded-xl uppercase tracking-widest hover:bg-cyan-500/10 transition-all">Crear Cuenta</button>
             </div>
        </section>

        <!-- Secciones de Login y Registro -->
        <section id="login-form" class="hidden-section fade-in">
            <div class="max-w-md mx-auto glass-morphism p-8 rounded-3xl">
                <h2 class="gaming-font text-xl text-center mb-6">INICIAR SESIÓN</h2>
                <form id="loginForm" class="space-y-4">
                    <input type="email" id="loginEmail" placeholder="Email" class="w-full p-4 rounded-xl outline-none" required>
                    <input type="password" id="loginPass" placeholder="Contraseña" class="w-full p-4 rounded-xl outline-none" required>
                    <button type="submit" id="loginBtn" class="w-full bg-cyan-500 text-black py-4 rounded-xl font-bold uppercase">Ingresar</button>
                    <button type="button" onclick="showSection('welcome-screen')" class="w-full text-gray-500 text-[10px] uppercase mt-2">Cancelar</button>
                </form>
            </div>
        </section>

        <section id="register-form" class="hidden-section fade-in">
            <div class="max-w-md mx-auto glass-morphism p-8 rounded-3xl">
                <h2 class="gaming-font text-xl text-center mb-6">REGISTRARSE</h2>
                <form id="registerForm" class="space-y-4">
                    <input type="email" id="regEmail" placeholder="Email" class="w-full p-4 rounded-xl outline-none" required>
                    <input type="password" id="regPass" placeholder="Contraseña" class="w-full p-4 rounded-xl outline-none" required>
                    <button type="submit" id="regBtn" class="w-full bg-cyan-500 text-black py-4 rounded-xl font-bold uppercase">Crear Cuenta</button>
                    <button type="button" onclick="showSection('welcome-screen')" class="w-full text-gray-500 text-[10px] uppercase mt-2">Cancelar</button>
                </form>
            </div>
        </section>

        <section id="home" class="hidden-section fade-in">
            <div class="text-center mb-8">
                <h1 class="gaming-font text-3xl mb-2 text-white">RECARGA <span class="text-cyan-400">AHORA</span></h1>
                <input type="number" id="playerID" class="max-w-xs w-full p-4 mt-4 rounded-2xl text-2xl text-center font-bold outline-none border-2 border-cyan-400/20" placeholder="ID JUGADOR">
            </div>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 max-w-4xl mx-auto text-center">
                <div class="glass-morphism p-6 rounded-3xl">
                    <p class="gaming-font text-cyan-400 text-sm mb-2">110 DIAMANTES</p>
                    <p class="text-2xl font-bold mb-4 text-white">$1.10</p>
                    <button onclick="alert('Sistema de pago en mantenimiento')" class="w-full bg-cyan-500 text-black py-3 rounded-xl font-bold uppercase text-[10px]">Comprar</button>
                </div>
                <div class="glass-morphism p-6 rounded-3xl">
                    <p class="gaming-font text-cyan-400 text-sm mb-2">530 DIAMANTES</p>
                    <p class="text-2xl font-bold mb-4 text-white">$5.50</p>
                    <button onclick="alert('Sistema de pago en mantenimiento')" class="w-full bg-cyan-500 text-black py-3 rounded-xl font-bold uppercase text-[10px]">Comprar</button>
                </div>
                <div class="glass-morphism p-6 rounded-3xl">
                    <p class="gaming-font text-cyan-400 text-sm mb-2">1080 DIAMANTES</p>
                    <p class="text-2xl font-bold mb-4 text-white">$11.00</p>
                    <button onclick="alert('Sistema de pago en mantenimiento')" class="w-full bg-cyan-500 text-black py-3 rounded-xl font-bold uppercase text-[10px]">Comprar</button>
                </div>
            </div>
        </section>

        <section id="ads-rewards" class="hidden-section fade-in">
            <div class="max-w-xl mx-auto text-center">
                <h2 class="gaming-font text-2xl text-yellow-400 mb-2 tracking-widest uppercase">Video recompensas</h2>
                <p class="text-gray-400 text-[10px] mb-6 px-4">Mira el video completo para desbloquear el reclamo de diamantes.</p>
                
                <div class="glass-morphism p-6 rounded-3xl">
                    <div class="ad-box" id="ad-container">
                        <span class="video-label"><i class="fas fa-video mr-1"></i> VIDEO AD</span>
                        
                        <!-- Unidad de anuncio optimizada para Video In-Feed -->
                        <ins class="adsbygoogle"
                             style="display:block"
                             data-ad-client="ca-pub-8397347098508270"
                             data-ad-slot="1133942942"
                             data-ad-format="fluid"
                             data-ad-layout-key="-fb+5w+4e-db+86"
                             data-full-width-responsive="true"></ins>
                    </div>

                    <div id="reward-status-box" class="mb-4">
                        <p id="status-text" class="text-cyan-400 gaming-font text-[10px]">BUSCANDO VIDEO DISPONIBLE...</p>
                    </div>

                    <button id="claim-reward-btn" onclick="processAdReward()" class="w-full py-4 rounded-xl font-bold uppercase bg-gray-600 text-gray-400 cursor-not-allowed">
                        RECLAMO BLOQUEADO
                    </button>
                    
                    <div class="mt-4 p-4 bg-cyan-500/5 border border-cyan-500/20 rounded-xl text-left">
                        <p class="text-[9px] text-gray-400 leading-relaxed">
                            <i class="fas fa-info-circle text-cyan-400 mr-1"></i>
                            Para ver anuncios de video, asegúrate de no usar bloqueadores de anuncios (AdBlock) y tener una conexión estable.
                        </p>
                    </div>
                </div>
            </div>
        </section>

        <section id="history" class="hidden-section fade-in">
            <h2 class="gaming-font text-center text-xl mb-6">MIS SOLICITUDES</h2>
            <div id="user-history-list" class="space-y-3 max-w-lg mx-auto"></div>
        </section>

        <section id="admin-panel" class="hidden-section fade-in">
            <h2 class="gaming-font text-red-500 text-center text-2xl mb-6 uppercase">Control de Entregas</h2>
            <div id="admin-orders-list" class="space-y-4 max-w-3xl mx-auto"></div>
        </section>

    </main>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, onAuthStateChanged, signOut, signInWithEmailAndPassword, createUserWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, collection, addDoc, getDocs, updateDoc, query } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBoBvAcaLGnPw69fwrfz_Al0L76foB1JtQ",
            authDomain: "recaga-de-diamante-de-fre-fi.firebaseapp.com",
            projectId: "recaga-de-diamante-de-fre-fi",
            storageBucket: "recaga-de-diamante-de-fre-fi.firebasestorage.app",
            messagingSenderId: "9751063285",
            appId: "1:9751063285:web:c1b3f8fd7c280f2d1773bc"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        
        let currentUser = null;
        const MASTER_ADMIN = "eduardgeldes6@gmail.com";

        window.showSection = (id) => {
            document.querySelectorAll('section').forEach(s => s.classList.add('hidden-section'));
            const section = document.getElementById(id);
            if(section) section.classList.remove('hidden-section');
            
            if (id === 'ads-rewards') checkAdAvailability();
            if (id === 'history') fetchHistory();
            if (id === 'admin-panel') fetchAdminOrders();
        };

        onAuthStateChanged(auth, (user) => {
            currentUser = user;
            if (user) {
                document.getElementById('main-nav').classList.remove('hidden-section');
                if(user.email === MASTER_ADMIN) document.getElementById('admin-nav-btn').classList.remove('hidden-section');
                showSection('home');
            } else {
                showSection('welcome-screen');
                document.getElementById('main-nav').classList.add('hidden-section');
            }
        });

        function checkAdAvailability() {
            const btn = document.getElementById('claim-reward-btn');
            const status = document.getElementById('status-text');
            const adIns = document.querySelector('ins.adsbygoogle');

            btn.className = "w-full py-4 rounded-xl font-bold uppercase bg-gray-600 text-gray-400 cursor-not-allowed";
            btn.innerText = "ESPERANDO VIDEO...";
            status.innerText = "BUSCANDO CONTENIDO MULTIMEDIA...";

            try { (window.adsbygoogle = window.adsbygoogle || []).push({}); } catch (e) {}

            let timer = 0;
            const checkInterval = setInterval(() => {
                timer++;
                // Verificamos si Google llenó el espacio y si tiene dimensiones de anuncio
                const isLoaded = adIns.getAttribute('data-ad-status') === 'filled';
                const hasContent = adIns.innerHTML.length > 100;

                if (isLoaded && hasContent) {
                    clearInterval(checkInterval);
                    status.innerText = "¡ANUNCIO LISTO! MIRA EL CONTENIDO";
                    status.className = "text-green-400 gaming-font text-[10px]";
                    
                    // Esperamos 5 segundos adicionales para que el usuario "vea" el video antes de habilitar
                    setTimeout(() => {
                        btn.className = "w-full py-4 rounded-xl font-bold uppercase bg-yellow-500 text-black shadow-lg cursor-pointer hover:scale-105 transition-all";
                        btn.innerText = "RECLAMAR 10 DIAMANTES";
                    }, 5000);
                } else if (timer > 25) {
                    clearInterval(checkInterval);
                    status.innerText = "SIN VIDEOS DISPONIBLES EN TU REGIÓN";
                    status.className = "text-red-500 gaming-font text-[10px]";
                    btn.innerText = "REINTENTAR LUEGO";
                }
            }, 1000);
        }

        window.processAdReward = async () => {
            const btn = document.getElementById('claim-reward-btn');
            const pid = document.getElementById('playerID').value;
            
            if (btn.classList.contains('cursor-not-allowed')) return;
            if (!pid || pid.length < 5) {
                alert("Primero ingresa tu ID de jugador en la tienda");
                showSection('home');
                return;
            }

            try {
                await addDoc(collection(db, 'pedidos'), {
                    userId: currentUser.uid,
                    userEmail: currentUser.email,
                    playerID: pid,
                    pack: '10 DIAMANTES (RECOMPENSA VIDEO)',
                    status: 'pendiente',
                    date: new Date().toLocaleString(),
                    timestamp: Date.now()
                });
                alert("¡Gracias por ver el video! Tu solicitud está en proceso.");
                showSection('history');
            } catch (e) {
                alert("Error al conectar con la base de datos.");
            }
        };

        // Auth Lógica
        document.getElementById('loginForm').onsubmit = async (e) => {
            e.preventDefault();
            const email = loginEmail.value;
            const pass = loginPass.value;
            try { await signInWithEmailAndPassword(auth, email, pass); } catch (err) { alert("Error al entrar"); }
        };

        document.getElementById('registerForm').onsubmit = async (e) => {
            e.preventDefault();
            const email = regEmail.value;
            const pass = regPass.value;
            try { await createUserWithEmailAndPassword(auth, email, pass); } catch (err) { alert("Error al crear cuenta"); }
        };

        window.handleLogout = () => signOut(auth);

        async function fetchHistory() {
            const container = document.getElementById('user-history-list');
            container.innerHTML = "<p class='text-center text-[10px]'>Cargando...</p>";
            const snap = await getDocs(collection(db, 'pedidos'));
            container.innerHTML = "";
            let count = 0;
            snap.forEach(d => {
                const o = d.data();
                if(o.userId === currentUser.uid) {
                    count++;
                    container.innerHTML += `
                    <div class="glass-morphism p-4 rounded-xl flex justify-between items-center mb-2 border-l-4 ${o.status === 'pendiente' ? 'border-yellow-500' : 'border-green-500'}">
                        <div><p class="text-xs font-bold text-white">${o.pack}</p><p class="text-[8px] text-gray-400">${o.date}</p></div>
                        <span class="status-pill status-${o.status}">${o.status}</span>
                    </div>`;
                }
            });
            if(count === 0) container.innerHTML = "<p class='text-center text-gray-500 text-xs'>No has visto videos aún.</p>";
        }

        window.fetchAdminOrders = async () => {
            const container = document.getElementById('admin-orders-list');
            container.innerHTML = "Cargando órdenes...";
            const snap = await getDocs(collection(db, 'pedidos'));
            container.innerHTML = "";
            snap.forEach(d => {
                const o = d.data();
                if(o.status === 'pendiente') {
                    container.innerHTML += `
                    <div class="glass-morphism p-4 rounded-xl flex justify-between items-center">
                        <div class="text-left"><p class="text-[10px] font-bold text-cyan-400">${o.pack}</p><p class="text-[9px] text-white">ID: ${o.playerID}</p></div>
                        <button onclick="markAsDone('${d.id}')" class="bg-green-600 px-3 py-1 rounded-lg font-bold text-[9px]">ENTREGAR</button>
                    </div>`;
                }
            });
        };

        window.markAsDone = async (id) => {
            try {
                await updateDoc(doc(db, 'pedidos', id), { status: 'completado' });
                fetchAdminOrders();
            } catch(e) { alert("Error"); }
        };

    </script>
</body>
</html>
